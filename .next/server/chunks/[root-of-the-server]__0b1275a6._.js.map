{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Volka/Documents/Sketching/WebApp/beeapp/src/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken'\r\n\r\nexport interface Session {\r\n  id: number\r\n  role: 'admin' | 'user'\r\n}\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'dev-secret'\r\n\r\nexport function signSession(session: Session) {\r\n  return jwt.sign(session, JWT_SECRET, { expiresIn: '7d' })\r\n}\r\n\r\nexport function verifySession(token: string): Session | null {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET) as Session\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\nexport const COOKIE_NAME = 'beeapp_token'\r\n"],"names":[],"mappings":";;;;;AAAA;;AAOA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,YAAY,OAAgB;IAC1C,OAAO,uIAAA,CAAA,UAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,cAAc,KAAa;IACzC,IAAI;QACF,OAAO,uIAAA,CAAA,UAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,MAAM,cAAc","debugId":null}},
    {"offset": {"line": 171, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Volka/Documents/Sketching/WebApp/beeapp/src/lib/db.ts"],"sourcesContent":["// Simple JSON file DB using lowdb for users, tasks, and assignments\r\nimport { JSONFilePreset } from 'lowdb/node'\r\nimport { existsSync, mkdirSync } from 'fs'\r\nimport { dirname } from 'path'\r\n\r\nexport type Role = 'admin' | 'user'\r\n\r\n\r\nexport interface User {\r\n  id: number\r\n  tagId: string\r\n  name?: string\r\n  role: Role\r\n  points: number\r\n}\r\n\r\nexport interface Task {\r\n  id: number\r\n  title: string\r\n  points: number\r\n  description?: string\r\n  tag?: string\r\n  tagIds?: number[]\r\n}\r\n\r\nexport type AssignmentStatus = 'assigned' | 'pending' | 'approved' | 'rejected'\r\n\r\nexport interface Assignment {\r\n  id: number\r\n  taskId: number\r\n  userId: number\r\n  status: AssignmentStatus\r\n  completedAt?: string\r\n}\r\n\r\nexport interface RFIDCard {\r\n  uid: string\r\n  userId: number\r\n  registeredAt: string\r\n}\r\n\r\nexport interface DBData {\r\n  users: User[]\r\n  tasks: Task[]\r\n  assignments: Assignment[]\r\n  tags: Tag[]\r\n  store: StoreItem[]\r\n  rfidCards: RFIDCard[]\r\n  nextIds: { user: number; task: number; assignment: number; tag: number; store: number }\r\n}\r\n\r\nconst defaultData: DBData = {\r\n  users: [],\r\n  tasks: [],\r\n  assignments: [],\r\n  tags: [],\r\n  store: [],\r\n  rfidCards: [],\r\n  nextIds: { user: 1, task: 1, assignment: 1, tag: 1, store: 1 },\r\n}\r\n\r\nlet dbPromise: ReturnType<typeof JSONFilePreset<DBData>> | null = null\r\n\r\nexport async function getDB() {\r\n  if (!dbPromise) {\r\n    const file = process.env.DB_FILE || 'data/db.json'\r\n  const dir = dirname(file)\r\n  if (!existsSync(dir)) mkdirSync(dir, { recursive: true })\r\n    dbPromise = JSONFilePreset<DBData>(file, defaultData)\r\n  }\r\n  const db = await dbPromise\r\n  // Lightweight migration for older DB files missing new fields\r\n  let migrated = false\r\n  if (!('tags' in db.data)) {\r\n    // @ts-ignore - add missing field for older files\r\n    ;(db.data as any).tags = []\r\n    migrated = true\r\n  }\r\n  if (!('store' in db.data)) {\r\n    ;(db.data as any).store = []\r\n    migrated = true\r\n  }\r\n  if (!('rfidCards' in db.data)) {\r\n    ;(db.data as any).rfidCards = []\r\n    migrated = true\r\n  }\r\n  if (!('nextIds' in db.data)) {\r\n    // Should never happen, but ensure structure\r\n    // @ts-ignore\r\n  ;(db.data as any).nextIds = { user: 1, task: 1, assignment: 1, tag: 1, store: 1 }\r\n    migrated = true\r\n  } else if (!('tag' in db.data.nextIds as any)) {\r\n    // initialize tag counter based on existing tags\r\n    const tagsArr: any[] = (db.data as any).tags || []\r\n    const nextTag = tagsArr.length > 0 ? Math.max(...tagsArr.map(t=>Number(t.id)||0)) + 1 : 1\r\n    // @ts-ignore\r\n    db.data.nextIds.tag = nextTag\r\n    migrated = true\r\n  }\r\n  if (!('store' in (db.data.nextIds as any))) {\r\n    const storeArr: any[] = (db.data as any).store || []\r\n    const nextStore = storeArr.length > 0 ? Math.max(...storeArr.map(s=>Number(s.id)||0)) + 1 : 1\r\n    // @ts-ignore\r\n    db.data.nextIds.store = nextStore\r\n    migrated = true\r\n  }\r\n  if (migrated) await db.write()\r\n  return db\r\n}\r\n\r\nexport async function seedAdminIfEmpty(adminTagId?: string) {\r\n  const db = await getDB()\r\n  const hasUsers = db.data.users.length > 0\r\n  if (!hasUsers) {\r\n    const id = db.data.nextIds.user++\r\n    db.data.users.push({ id, tagId: adminTagId || 'ADMIN_TAG', role: 'admin', points: 0 })\r\n    await db.write()\r\n  }\r\n}\r\n\r\nexport async function findOrCreateUserByTag(tagId: string) {\r\n  const db = await getDB()\r\n  let user = db.data.users.find((u: User) => u.tagId === tagId)\r\n  if (!user) {\r\n    const id = db.data.nextIds.user++\r\n    user = { id, tagId, role: 'user', points: 0 }\r\n    db.data.users.push(user)\r\n    await db.write()\r\n  }\r\n  return user\r\n}\r\n\r\nexport async function findUserByTag(tagId: string) {\r\n  const db = await getDB()\r\n  return db.data.users.find((u: User) => u.tagId === tagId) || null\r\n}\r\n\r\nexport async function createUser(tagId: string, name: string, role: Role = 'user') {\r\n  const db = await getDB()\r\n  const exists = db.data.users.find((u: User) => u.tagId === tagId)\r\n  if (exists) return null\r\n  const id = db.data.nextIds.user++\r\n  const user: User = { id, tagId, name, role, points: 0 }\r\n  db.data.users.push(user)\r\n  await db.write()\r\n  return user\r\n}\r\n\r\nexport async function getUser(id: number) {\r\n  const db = await getDB()\r\n  return db.data.users.find((u: User) => u.id === id) || null\r\n}\r\n\r\nexport async function createTask(title: string, points: number, description?: string, tag?: string) {\r\n  const db = await getDB()\r\n  const id = db.data.nextIds.task++\r\n  const task: Task = { id, title, points, description, tag }\r\n  db.data.tasks.push(task)\r\n  await db.write()\r\n  return task\r\n}\r\n\r\nexport async function updateTask(id: number, data: { title?: string; points?: number; description?: string; tagId?: number | null }) {\r\n  const db = await getDB()\r\n  const t = db.data.tasks.find((t: Task) => t.id === id)\r\n  if (!t) return null\r\n  if (typeof data.title === 'string') t.title = data.title\r\n  if (typeof data.points === 'number') t.points = data.points\r\n  if (typeof data.description === 'string') t.description = data.description\r\n  if (data.tagId === null) t.tagId = undefined\r\n  if (typeof data.tagId === 'number') t.tagId = data.tagId\r\n  await db.write()\r\n  return t\r\n}\r\n\r\nexport async function deleteTask(id: number) {\r\n  const db = await getDB()\r\n  const idx = db.data.tasks.findIndex((t: Task) => t.id === id)\r\n  if (idx === -1) return false\r\n  db.data.tasks.splice(idx, 1)\r\n  // Also delete related assignments\r\n  const assignIdx = db.data.assignments.findIndex((a: Assignment) => a.taskId === id)\r\n  if (assignIdx !== -1) db.data.assignments.splice(assignIdx, 1)\r\n  await db.write()\r\n  return true\r\n}\r\n\r\nexport async function assignTask(taskId: number, userId: number) {\r\n  const db = await getDB()\r\n  const id = db.data.nextIds.assignment++\r\n  const assignment: Assignment = { id, taskId, userId, status: 'assigned' }\r\n  db.data.assignments.push(assignment)\r\n  await db.write()\r\n  return assignment\r\n}\r\n\r\nexport async function listAssignmentsForUser(userId: number) {\r\n  const db = await getDB()\r\n  return db.data.assignments.filter((a: Assignment) => a.userId === userId)\r\n}\r\n\r\nexport async function listAllAssignments() {\r\n  const db = await getDB()\r\n  return db.data.assignments\r\n}\r\n\r\nexport async function setAssignmentStatus(id: number, status: AssignmentStatus) {\r\n  const db = await getDB()\r\n  const a = db.data.assignments.find((x: Assignment) => x.id === id)\r\n  if (!a) return null\r\n  a.status = status\r\n  if (status === 'pending') a.completedAt = new Date().toISOString()\r\n  await db.write()\r\n  return a\r\n}\r\n\r\nexport async function approveAssignment(id: number) {\r\n  const db = await getDB()\r\n  const a = db.data.assignments.find((x: Assignment) => x.id === id)\r\n  if (!a) return null\r\n  const task = db.data.tasks.find((t: Task) => t.id === a.taskId)\r\n  const user = db.data.users.find((u: User) => u.id === a.userId)\r\n  if (!task || !user) return null\r\n  a.status = 'approved'\r\n  user.points += task.points\r\n  await db.write()\r\n  return { assignment: a, task, user }\r\n}\r\n\r\nexport async function deleteAssignment(id: number) {\r\n  const db = await getDB()\r\n  const idx = db.data.assignments.findIndex((a: Assignment) => a.id === id)\r\n  if (idx === -1) return false\r\n  db.data.assignments.splice(idx, 1)\r\n  await db.write()\r\n  return true\r\n}\r\n\r\nexport async function getTask(id: number) {\r\n  const db = await getDB()\r\n  return db.data.tasks.find((t: Task) => t.id === id) || null\r\n}\r\n\r\nexport async function listTasks() {\r\n  const db = await getDB()\r\n  return db.data.tasks\r\n}\r\n\r\nexport async function listUsers() {\r\n  const db = await getDB()\r\n  return db.data.users\r\n}\r\n\r\nexport async function adjustUserPoints(userId: number, delta: number) {\r\n  const db = await getDB()\r\n  const user = db.data.users.find((u: User) => u.id === userId)\r\n  if (!user) return null\r\n  const newPoints = user.points + delta\r\n  if (newPoints < 0) return null\r\n  user.points = newPoints\r\n  await db.write()\r\n  return user\r\n}\r\n\r\nexport async function updateUserRole(userId: number, role: Role) {\r\n  const db = await getDB()\r\n  const user = db.data.users.find((u: User) => u.id === userId)\r\n  if (!user) return null\r\n  user.role = role\r\n  await db.write()\r\n  return user\r\n}\r\n\r\nexport async function deleteUser(userId: number) {\r\n  const db = await getDB()\r\n  const idx = db.data.users.findIndex((u: User) => u.id === userId)\r\n  if (idx === -1) return false\r\n  db.data.users.splice(idx, 1)\r\n  // remove assignments belonging to user\r\n  db.data.assignments = db.data.assignments.filter((a: Assignment) => a.userId !== userId)\r\n  await db.write()\r\n  return true\r\n}\r\n\r\n// Tags\r\nexport interface Tag {\r\n  id: number\r\n  name: string\r\n  color: string // hex like #RRGGBB\r\n}\r\n\r\n// Store (PrÃ¤mien) items\r\nexport interface StoreItem {\r\n  id: number\r\n  title: string\r\n  cost: number // points required\r\n  description?: string\r\n}\r\n\r\nexport async function createTag(name: string, color: string) {\r\n  const db = await getDB()\r\n  const id = db.data.nextIds.tag++\r\n  const tag: Tag = { id, name, color }\r\n  db.data.tags.push(tag)\r\n  await db.write()\r\n  return tag\r\n}\r\n\r\nexport async function listTags() {\r\n  const db = await getDB()\r\n  return db.data.tags\r\n}\r\n\r\nexport async function deleteTag(tagId: number) {\r\n  const db = await getDB()\r\n  const idx = db.data.tags.findIndex((t: Tag) => t.id === tagId)\r\n  if (idx === -1) return false\r\n  db.data.tags.splice(idx, 1)\r\n  // unset tagId on tasks using this tag\r\n  db.data.tasks.forEach((t: Task) => { if (t.tagIds?.includes(tagId)) t.tagIds = t.tagIds.filter(id => id !== tagId) })\r\n  await db.write()\r\n  return true\r\n}\r\n\r\nexport async function setTaskTags(taskId: number, tagIds?: number[] | null) {\r\n  const db = await getDB()\r\n  const t = db.data.tasks.find((t: Task) => t.id === taskId)\r\n  if (!t) return null\r\n  console.log('[setTaskTags] Before:', t)\r\n  if (!tagIds || tagIds.length === 0) {\r\n    delete t.tagIds\r\n  } else {\r\n    t.tagIds = tagIds\r\n  }\r\n  console.log('[setTaskTags] After:', t)\r\n  await db.write()\r\n  return t\r\n}\r\n\r\n// Store helpers\r\nexport async function createStoreItem(title: string, cost: number, description?: string) {\r\n  const db = await getDB()\r\n  const id = db.data.nextIds.store++\r\n  const item: StoreItem = { id, title, cost, description }\r\n  db.data.store.push(item)\r\n  await db.write()\r\n  return item\r\n}\r\n\r\nexport async function listStoreItems() {\r\n  const db = await getDB()\r\n  return db.data.store\r\n}\r\n\r\nexport async function deleteStoreItem(itemId: number) {\r\n  const db = await getDB()\r\n  const idx = db.data.store.findIndex((s: StoreItem) => s.id === itemId)\r\n  if (idx === -1) return false\r\n  db.data.store.splice(idx, 1)\r\n  await db.write()\r\n  return true\r\n}\r\n\r\nexport async function redeemStoreItem(userId: number, itemId: number) {\r\n  const db = await getDB()\r\n  const user = db.data.users.find(u => u.id === userId)\r\n  const item = db.data.store.find(s => s.id === itemId)\r\n  if (!user || !item) return { ok: false as const, error: 'Not found' }\r\n  if (user.points < item.cost) return { ok: false as const, error: 'Zu wenig Punkte' }\r\n  user.points -= item.cost\r\n  await db.write()\r\n  return { ok: true as const, user, item }\r\n}\r\n\r\n// RFID Card helpers\r\nexport async function registerRFIDCard(uid: string, userId: number) {\r\n  const db = await getDB()\r\n  // Check if already registered\r\n  const existing = db.data.rfidCards.find(c => c.uid === uid)\r\n  if (existing) return null\r\n  const card: RFIDCard = { uid, userId, registeredAt: new Date().toISOString() }\r\n  db.data.rfidCards.push(card)\r\n  await db.write()\r\n  return card\r\n}\r\n\r\nexport async function findUserByRFID(uid: string) {\r\n  const db = await getDB()\r\n  const card = db.data.rfidCards.find(c => c.uid === uid)\r\n  if (!card) return null\r\n  return db.data.users.find(u => u.id === card.userId) || null\r\n}\r\n\r\nexport async function unregisterRFIDCard(uid: string) {\r\n  const db = await getDB()\r\n  const idx = db.data.rfidCards.findIndex(c => c.uid === uid)\r\n  if (idx === -1) return false\r\n  db.data.rfidCards.splice(idx, 1)\r\n  await db.write()\r\n  return true\r\n}\r\n\r\nexport async function listRFIDCards() {\r\n  const db = await getDB()\r\n  return db.data.rfidCards\r\n}\r\n\r\nexport async function getRFIDCardsForUser(userId: number) {\r\n  const db = await getDB()\r\n  return db.data.rfidCards.filter(c => c.userId === userId)\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 601, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Volka/Documents/Sketching/WebApp/beeapp/src/app/api/admin/tasks/set-tag/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { COOKIE_NAME, verifySession } from '@/lib/auth'\r\nimport { listTags, setTaskTags } from '@/lib/db'\r\n\r\nexport async function PATCH(req: NextRequest) {\r\n  try {\r\n    const token = req.cookies.get(COOKIE_NAME)?.value\r\n    const session = token ? verifySession(token) : null\r\n    if (!session || session.role !== 'admin') return NextResponse.json({ error: 'forbidden' }, { status: 403 })\r\n    const body = await req.json().catch(()=>null) as { taskId?: number; tagIds?: number[]|null }\r\n    console.log('[set-tag] Received:', body)\r\n    if (!body?.taskId) return NextResponse.json({ error: 'taskId required' }, { status: 400 })\r\n    // validate tagIds if provided\r\n    if (body.tagIds && body.tagIds.length > 0) {\r\n      const tags = await listTags()\r\n      const allValid = body.tagIds.every(tagId => tags.some(t => t.id === tagId))\r\n      console.log('[set-tag] Validating tagIds:', body.tagIds, 'allValid:', allValid)\r\n      if (!allValid) return NextResponse.json({ error: 'one or more tags not found' }, { status: 404 })\r\n    }\r\n    const updated = await setTaskTags(body.taskId, body.tagIds ?? undefined)\r\n    console.log('[set-tag] Updated task:', updated)\r\n    if (!updated) return NextResponse.json({ error: 'task not found' }, { status: 404 })\r\n    return NextResponse.json({ task: updated })\r\n  } catch (e) {\r\n    console.error('[set-tag] Error:', e)\r\n    return NextResponse.json({ error: 'server error' }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;;;;AAEO,eAAe,MAAM,GAAgB;IAC1C,IAAI;QACF,MAAM,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,oHAAA,CAAA,cAAW,GAAG;QAC5C,MAAM,UAAU,QAAQ,CAAA,GAAA,oHAAA,CAAA,gBAAa,AAAD,EAAE,SAAS;QAC/C,IAAI,CAAC,WAAW,QAAQ,IAAI,KAAK,SAAS,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAY,GAAG;YAAE,QAAQ;QAAI;QACzG,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAI;QACxC,QAAQ,GAAG,CAAC,uBAAuB;QACnC,IAAI,CAAC,MAAM,QAAQ,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAkB,GAAG;YAAE,QAAQ;QAAI;QACxF,8BAA8B;QAC9B,IAAI,KAAK,MAAM,IAAI,KAAK,MAAM,CAAC,MAAM,GAAG,GAAG;YACzC,MAAM,OAAO,MAAM,CAAA,GAAA,kHAAA,CAAA,WAAQ,AAAD;YAC1B,MAAM,WAAW,KAAK,MAAM,CAAC,KAAK,CAAC,CAAA,QAAS,KAAK,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;YACpE,QAAQ,GAAG,CAAC,gCAAgC,KAAK,MAAM,EAAE,aAAa;YACtE,IAAI,CAAC,UAAU,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QACjG;QACA,MAAM,UAAU,MAAM,CAAA,GAAA,kHAAA,CAAA,cAAW,AAAD,EAAE,KAAK,MAAM,EAAE,KAAK,MAAM,IAAI;QAC9D,QAAQ,GAAG,CAAC,2BAA2B;QACvC,IAAI,CAAC,SAAS,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;QAClF,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,MAAM;QAAQ;IAC3C,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF","debugId":null}}]
}