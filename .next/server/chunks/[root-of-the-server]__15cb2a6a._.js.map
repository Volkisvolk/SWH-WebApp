{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Volka/Documents/Sketching/WebApp/beeapp/src/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken'\r\n\r\nexport interface Session {\r\n  id: number\r\n  role: 'admin' | 'user'\r\n}\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'dev-secret'\r\n\r\nexport function signSession(session: Session) {\r\n  return jwt.sign(session, JWT_SECRET, { expiresIn: '7d' })\r\n}\r\n\r\nexport function verifySession(token: string): Session | null {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET) as Session\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\nexport const COOKIE_NAME = 'beeapp_token'\r\n"],"names":[],"mappings":";;;;;AAAA;;AAOA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,YAAY,OAAgB;IAC1C,OAAO,uIAAA,CAAA,UAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,cAAc,KAAa;IACzC,IAAI;QACF,OAAO,uIAAA,CAAA,UAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,MAAM,cAAc","debugId":null}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Volka/Documents/Sketching/WebApp/beeapp/src/lib/db.ts"],"sourcesContent":["// Simple JSON file DB using lowdb for users, tasks, and assignments\r\nimport { JSONFilePreset } from 'lowdb/node'\r\n\r\nexport type Role = 'admin' | 'user'\r\n\r\nexport interface User {\r\n  id: number\r\n  tagId: string\r\n  name?: string\r\n  role: Role\r\n  points: number\r\n}\r\n\r\nexport interface Task {\r\n  id: number\r\n  title: string\r\n  points: number\r\n  description?: string\r\n  tag?: string\r\n  tagId?: number\r\n}\r\n\r\nexport type AssignmentStatus = 'assigned' | 'pending' | 'approved' | 'rejected'\r\n\r\nexport interface Assignment {\r\n  id: number\r\n  taskId: number\r\n  userId: number\r\n  status: AssignmentStatus\r\n  completedAt?: string\r\n}\r\n\r\nexport interface DBData {\r\n  users: User[]\r\n  tasks: Task[]\r\n  assignments: Assignment[]\r\n  tags: Tag[]\r\n  nextIds: { user: number; task: number; assignment: number; tag: number }\r\n}\r\n\r\nconst defaultData: DBData = {\r\n  users: [],\r\n  tasks: [],\r\n  assignments: [],\r\n  tags: [],\r\n  nextIds: { user: 1, task: 1, assignment: 1, tag: 1 },\r\n}\r\n\r\nlet dbPromise: ReturnType<typeof JSONFilePreset<DBData>> | null = null\r\n\r\nexport async function getDB() {\r\n  if (!dbPromise) {\r\n    const file = process.env.DB_FILE || 'data/db.json'\r\n    dbPromise = JSONFilePreset<DBData>(file, defaultData)\r\n  }\r\n  const db = await dbPromise\r\n  return db\r\n}\r\n\r\nexport async function seedAdminIfEmpty(adminTagId?: string) {\r\n  const db = await getDB()\r\n  const hasUsers = db.data.users.length > 0\r\n  if (!hasUsers) {\r\n    const id = db.data.nextIds.user++\r\n    db.data.users.push({ id, tagId: adminTagId || 'ADMIN_TAG', role: 'admin', points: 0 })\r\n    await db.write()\r\n  }\r\n}\r\n\r\nexport async function findOrCreateUserByTag(tagId: string) {\r\n  const db = await getDB()\r\n  let user = db.data.users.find((u: User) => u.tagId === tagId)\r\n  if (!user) {\r\n    const id = db.data.nextIds.user++\r\n    user = { id, tagId, role: 'user', points: 0 }\r\n    db.data.users.push(user)\r\n    await db.write()\r\n  }\r\n  return user\r\n}\r\n\r\nexport async function findUserByTag(tagId: string) {\r\n  const db = await getDB()\r\n  return db.data.users.find((u: User) => u.tagId === tagId) || null\r\n}\r\n\r\nexport async function createUser(tagId: string, name: string, role: Role = 'user') {\r\n  const db = await getDB()\r\n  const exists = db.data.users.find((u: User) => u.tagId === tagId)\r\n  if (exists) return null\r\n  const id = db.data.nextIds.user++\r\n  const user: User = { id, tagId, name, role, points: 0 }\r\n  db.data.users.push(user)\r\n  await db.write()\r\n  return user\r\n}\r\n\r\nexport async function getUser(id: number) {\r\n  const db = await getDB()\r\n  return db.data.users.find((u: User) => u.id === id) || null\r\n}\r\n\r\nexport async function createTask(title: string, points: number, description?: string, tag?: string) {\r\n  const db = await getDB()\r\n  const id = db.data.nextIds.task++\r\n  const task: Task = { id, title, points, description, tag }\r\n  db.data.tasks.push(task)\r\n  await db.write()\r\n  return task\r\n}\r\n\r\nexport async function assignTask(taskId: number, userId: number) {\r\n  const db = await getDB()\r\n  const id = db.data.nextIds.assignment++\r\n  const assignment: Assignment = { id, taskId, userId, status: 'assigned' }\r\n  db.data.assignments.push(assignment)\r\n  await db.write()\r\n  return assignment\r\n}\r\n\r\nexport async function listAssignmentsForUser(userId: number) {\r\n  const db = await getDB()\r\n  return db.data.assignments.filter((a: Assignment) => a.userId === userId)\r\n}\r\n\r\nexport async function listAllAssignments() {\r\n  const db = await getDB()\r\n  return db.data.assignments\r\n}\r\n\r\nexport async function setAssignmentStatus(id: number, status: AssignmentStatus) {\r\n  const db = await getDB()\r\n  const a = db.data.assignments.find((x: Assignment) => x.id === id)\r\n  if (!a) return null\r\n  a.status = status\r\n  if (status === 'pending') a.completedAt = new Date().toISOString()\r\n  await db.write()\r\n  return a\r\n}\r\n\r\nexport async function approveAssignment(id: number) {\r\n  const db = await getDB()\r\n  const a = db.data.assignments.find((x: Assignment) => x.id === id)\r\n  if (!a) return null\r\n  const task = db.data.tasks.find((t: Task) => t.id === a.taskId)\r\n  const user = db.data.users.find((u: User) => u.id === a.userId)\r\n  if (!task || !user) return null\r\n  a.status = 'approved'\r\n  user.points += task.points\r\n  await db.write()\r\n  return { assignment: a, task, user }\r\n}\r\n\r\nexport async function getTask(id: number) {\r\n  const db = await getDB()\r\n  return db.data.tasks.find((t: Task) => t.id === id) || null\r\n}\r\n\r\nexport async function listTasks() {\r\n  const db = await getDB()\r\n  return db.data.tasks\r\n}\r\n\r\nexport async function listUsers() {\r\n  const db = await getDB()\r\n  return db.data.users\r\n}\r\n\r\nexport async function adjustUserPoints(userId: number, delta: number) {\r\n  const db = await getDB()\r\n  const user = db.data.users.find((u: User) => u.id === userId)\r\n  if (!user) return null\r\n  const newPoints = user.points + delta\r\n  if (newPoints < 0) return null\r\n  user.points = newPoints\r\n  await db.write()\r\n  return user\r\n}\r\n\r\nexport async function updateUserRole(userId: number, role: Role) {\r\n  const db = await getDB()\r\n  const user = db.data.users.find((u: User) => u.id === userId)\r\n  if (!user) return null\r\n  user.role = role\r\n  await db.write()\r\n  return user\r\n}\r\n\r\nexport async function deleteUser(userId: number) {\r\n  const db = await getDB()\r\n  const idx = db.data.users.findIndex((u: User) => u.id === userId)\r\n  if (idx === -1) return false\r\n  db.data.users.splice(idx, 1)\r\n  // remove assignments belonging to user\r\n  db.data.assignments = db.data.assignments.filter((a: Assignment) => a.userId !== userId)\r\n  await db.write()\r\n  return true\r\n}\r\n\r\n// Tags\r\nexport interface Tag {\r\n  id: number\r\n  name: string\r\n  color: string // hex like #RRGGBB\r\n}\r\n\r\nexport async function createTag(name: string, color: string) {\r\n  const db = await getDB()\r\n  const id = db.data.nextIds.tag++\r\n  const tag: Tag = { id, name, color }\r\n  db.data.tags.push(tag)\r\n  await db.write()\r\n  return tag\r\n}\r\n\r\nexport async function listTags() {\r\n  const db = await getDB()\r\n  return db.data.tags\r\n}\r\n\r\nexport async function deleteTag(tagId: number) {\r\n  const db = await getDB()\r\n  const idx = db.data.tags.findIndex((t: Tag) => t.id === tagId)\r\n  if (idx === -1) return false\r\n  db.data.tags.splice(idx, 1)\r\n  // unset tagId on tasks using this tag\r\n  db.data.tasks.forEach((t: Task) => { if (t.tagId === tagId) t.tagId = undefined })\r\n  await db.write()\r\n  return true\r\n}\r\n\r\nexport async function setTaskTag(taskId: number, tagId?: number) {\r\n  const db = await getDB()\r\n  const t = db.data.tasks.find((t: Task) => t.id === taskId)\r\n  if (!t) return null\r\n  t.tagId = tagId\r\n  await db.write()\r\n  return t\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 398, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Volka/Documents/Sketching/WebApp/beeapp/src/app/api/user/assignments/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { COOKIE_NAME, verifySession } from '@/lib/auth'\r\nimport { listAssignmentsForUser, listTasks } from '@/lib/db'\r\n\r\nexport async function GET(req: NextRequest) {\r\n  const token = req.cookies.get(COOKIE_NAME)?.value\r\n  if (!token) return NextResponse.json({ assignments: [] })\r\n  const session = verifySession(token)\r\n  if (!session) return NextResponse.json({ assignments: [] })\r\n  const [assignments, tasks] = await Promise.all([\r\n    listAssignmentsForUser(session.id),\r\n    listTasks(),\r\n  ])\r\n  const withDetails = assignments.map(a => {\r\n    const t = tasks.find(t => t.id === a.taskId)\r\n    return { ...a, taskTitle: t?.title || `Task #${a.taskId}`, taskPoints: t?.points ?? 0, description: t?.description, tag: t?.tag }\r\n  })\r\n  return NextResponse.json({ assignments: withDetails })\r\n}\r\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,GAAgB;IACxC,MAAM,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,oHAAA,CAAA,cAAW,GAAG;IAC5C,IAAI,CAAC,OAAO,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE,aAAa,EAAE;IAAC;IACvD,MAAM,UAAU,CAAA,GAAA,oHAAA,CAAA,gBAAa,AAAD,EAAE;IAC9B,IAAI,CAAC,SAAS,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE,aAAa,EAAE;IAAC;IACzD,MAAM,CAAC,aAAa,MAAM,GAAG,MAAM,QAAQ,GAAG,CAAC;QAC7C,CAAA,GAAA,kHAAA,CAAA,yBAAsB,AAAD,EAAE,QAAQ,EAAE;QACjC,CAAA,GAAA,kHAAA,CAAA,YAAS,AAAD;KACT;IACD,MAAM,cAAc,YAAY,GAAG,CAAC,CAAA;QAClC,MAAM,IAAI,MAAM,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,EAAE,MAAM;QAC3C,OAAO;YAAE,GAAG,CAAC;YAAE,WAAW,GAAG,SAAS,CAAC,MAAM,EAAE,EAAE,MAAM,EAAE;YAAE,YAAY,GAAG,UAAU;YAAG,aAAa,GAAG;YAAa,KAAK,GAAG;QAAI;IAClI;IACA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE,aAAa;IAAY;AACtD","debugId":null}}]
}