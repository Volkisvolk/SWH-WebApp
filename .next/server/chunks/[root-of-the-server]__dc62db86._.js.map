{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Volka/Documents/Sketching/WebApp/beeapp/src/lib/db.ts"],"sourcesContent":["// Simple JSON file DB using lowdb for users, tasks, and assignments\r\nimport { JSONFilePreset } from 'lowdb/node'\r\n\r\nexport type Role = 'admin' | 'user'\r\n\r\nexport interface User {\r\n  id: number\r\n  tagId: string\r\n  name?: string\r\n  role: Role\r\n  points: number\r\n}\r\n\r\nexport interface Task {\r\n  id: number\r\n  title: string\r\n  points: number\r\n}\r\n\r\nexport type AssignmentStatus = 'assigned' | 'pending' | 'approved' | 'rejected'\r\n\r\nexport interface Assignment {\r\n  id: number\r\n  taskId: number\r\n  userId: number\r\n  status: AssignmentStatus\r\n  completedAt?: string\r\n}\r\n\r\nexport interface DBData {\r\n  users: User[]\r\n  tasks: Task[]\r\n  assignments: Assignment[]\r\n  nextIds: { user: number; task: number; assignment: number }\r\n}\r\n\r\nconst defaultData: DBData = {\r\n  users: [],\r\n  tasks: [],\r\n  assignments: [],\r\n  nextIds: { user: 1, task: 1, assignment: 1 },\r\n}\r\n\r\nlet dbPromise: ReturnType<typeof JSONFilePreset<DBData>> | null = null\r\n\r\nexport async function getDB() {\r\n  if (!dbPromise) {\r\n    const file = process.env.DB_FILE || 'data/db.json'\r\n    dbPromise = JSONFilePreset<DBData>(file, defaultData)\r\n  }\r\n  const db = await dbPromise\r\n  return db\r\n}\r\n\r\nexport async function seedAdminIfEmpty(adminTagId?: string) {\r\n  const db = await getDB()\r\n  const hasUsers = db.data.users.length > 0\r\n  if (!hasUsers) {\r\n    const id = db.data.nextIds.user++\r\n    db.data.users.push({ id, tagId: adminTagId || 'ADMIN_TAG', role: 'admin', points: 0 })\r\n    await db.write()\r\n  }\r\n}\r\n\r\nexport async function findOrCreateUserByTag(tagId: string) {\r\n  const db = await getDB()\r\n  let user = db.data.users.find((u: User) => u.tagId === tagId)\r\n  if (!user) {\r\n    const id = db.data.nextIds.user++\r\n    user = { id, tagId, role: 'user', points: 0 }\r\n    db.data.users.push(user)\r\n    await db.write()\r\n  }\r\n  return user\r\n}\r\n\r\nexport async function findUserByTag(tagId: string) {\r\n  const db = await getDB()\r\n  return db.data.users.find((u: User) => u.tagId === tagId) || null\r\n}\r\n\r\nexport async function createUser(tagId: string, name: string, role: Role = 'user') {\r\n  const db = await getDB()\r\n  const exists = db.data.users.find((u: User) => u.tagId === tagId)\r\n  if (exists) return null\r\n  const id = db.data.nextIds.user++\r\n  const user: User = { id, tagId, name, role, points: 0 }\r\n  db.data.users.push(user)\r\n  await db.write()\r\n  return user\r\n}\r\n\r\nexport async function getUser(id: number) {\r\n  const db = await getDB()\r\n  return db.data.users.find((u: User) => u.id === id) || null\r\n}\r\n\r\nexport async function createTask(title: string, points: number) {\r\n  const db = await getDB()\r\n  const id = db.data.nextIds.task++\r\n  const task: Task = { id, title, points }\r\n  db.data.tasks.push(task)\r\n  await db.write()\r\n  return task\r\n}\r\n\r\nexport async function assignTask(taskId: number, userId: number) {\r\n  const db = await getDB()\r\n  const id = db.data.nextIds.assignment++\r\n  const assignment: Assignment = { id, taskId, userId, status: 'assigned' }\r\n  db.data.assignments.push(assignment)\r\n  await db.write()\r\n  return assignment\r\n}\r\n\r\nexport async function listAssignmentsForUser(userId: number) {\r\n  const db = await getDB()\r\n  return db.data.assignments.filter((a: Assignment) => a.userId === userId)\r\n}\r\n\r\nexport async function listAllAssignments() {\r\n  const db = await getDB()\r\n  return db.data.assignments\r\n}\r\n\r\nexport async function setAssignmentStatus(id: number, status: AssignmentStatus) {\r\n  const db = await getDB()\r\n  const a = db.data.assignments.find((x: Assignment) => x.id === id)\r\n  if (!a) return null\r\n  a.status = status\r\n  if (status === 'pending') a.completedAt = new Date().toISOString()\r\n  await db.write()\r\n  return a\r\n}\r\n\r\nexport async function approveAssignment(id: number) {\r\n  const db = await getDB()\r\n  const a = db.data.assignments.find((x: Assignment) => x.id === id)\r\n  if (!a) return null\r\n  const task = db.data.tasks.find((t: Task) => t.id === a.taskId)\r\n  const user = db.data.users.find((u: User) => u.id === a.userId)\r\n  if (!task || !user) return null\r\n  a.status = 'approved'\r\n  user.points += task.points\r\n  await db.write()\r\n  return { assignment: a, task, user }\r\n}\r\n\r\nexport async function getTask(id: number) {\r\n  const db = await getDB()\r\n  return db.data.tasks.find((t: Task) => t.id === id) || null\r\n}\r\n\r\nexport async function listTasks() {\r\n  const db = await getDB()\r\n  return db.data.tasks\r\n}\r\n\r\nexport async function listUsers() {\r\n  const db = await getDB()\r\n  return db.data.users\r\n}\r\n\r\nexport async function adjustUserPoints(userId: number, delta: number) {\r\n  const db = await getDB()\r\n  const user = db.data.users.find((u: User) => u.id === userId)\r\n  if (!user) return null\r\n  const newPoints = user.points + delta\r\n  if (newPoints < 0) return null\r\n  user.points = newPoints\r\n  await db.write()\r\n  return user\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 277, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Volka/Documents/Sketching/WebApp/beeapp/src/app/api/register/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { createUser, findUserByTag, seedAdminIfEmpty } from '@/lib/db'\r\n\r\nexport async function POST(req: NextRequest) {\r\n  const body = await req.json().catch(() => null) as { tagId?: string; name?: string }\r\n  if (!body?.tagId || !body?.name) return NextResponse.json({ error: 'tagId and name required' }, { status: 400 })\r\n  await seedAdminIfEmpty(process.env.ADMIN_TAG)\r\n  const exists = await findUserByTag(body.tagId)\r\n  if (exists) return NextResponse.json({ error: 'tag already registered' }, { status: 409 })\r\n  const user = await createUser(body.tagId, body.name)\r\n  return NextResponse.json({ user })\r\n}\r\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEO,eAAe,KAAK,GAAgB;IACzC,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM;IAC1C,IAAI,CAAC,MAAM,SAAS,CAAC,MAAM,MAAM,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAA0B,GAAG;QAAE,QAAQ;IAAI;IAC9G,MAAM,CAAA,GAAA,kHAAA,CAAA,mBAAgB,AAAD,EAAE,QAAQ,GAAG,CAAC,SAAS;IAC5C,MAAM,SAAS,MAAM,CAAA,GAAA,kHAAA,CAAA,gBAAa,AAAD,EAAE,KAAK,KAAK;IAC7C,IAAI,QAAQ,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAyB,GAAG;QAAE,QAAQ;IAAI;IACxF,MAAM,OAAO,MAAM,CAAA,GAAA,kHAAA,CAAA,aAAU,AAAD,EAAE,KAAK,KAAK,EAAE,KAAK,IAAI;IACnD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE;IAAK;AAClC","debugId":null}}]
}