{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Volka/Documents/Sketching/WebApp/beeapp/src/app/dashboard/page.tsx"],"sourcesContent":["'use client'\r\nimport { useEffect, useState } from 'react'\r\n\r\ntype User = { id:number; role:'admin'|'user'; points:number; tagId:string; name?:string }\r\n\r\ntype Assignment = { id:number; taskId:number; userId:number; status:string; taskTitle?:string; taskPoints?:number; description?:string; tag?:string }\r\ntype StoreItem = { id:number; title:string; cost:number; description?:string }\r\n\r\nexport default function DashboardPage() {\r\n  const [user, setUser] = useState<User | null>(null)\r\n  const [assignments, setAssignments] = useState<Assignment[]>([])\r\n  const [redeemPoints, setRedeemPoints] = useState<number|''>('')\r\n  const [items, setItems] = useState<StoreItem[]>([])\r\n  const [notice, setNotice] = useState<{ type: 'success'|'error'; text: string } | null>(null)\r\n\r\n  useEffect(() => {\r\n    const load = async () => {\r\n      const r = await fetch('/api/me', { cache: 'no-store' })\r\n      const d = await r.json()\r\n      if (d.user?.role === 'admin') {\r\n        window.location.href = '/admin/workspace'\r\n        return\r\n      }\r\n      setUser(d.user || null)\r\n      if (d.user) {\r\n        const r2 = await fetch('/api/user/assignments', { cache: 'no-store' }).catch(()=>null)\r\n        const d2 = r2 ? await r2.json() : { assignments: [] }\r\n        setAssignments(d2.assignments || [])\r\n        const r3 = await fetch('/api/store', { cache: 'no-store' }).catch(()=>null)\r\n        const d3 = r3 ? await r3.json() : { items: [] }\r\n        setItems(d3.items || [])\r\n      }\r\n    }\r\n    load()\r\n  }, [])\r\n\r\n  if (!user) return <div className=\"container\">Bitte einloggen…</div>\r\n\r\n  return (\r\n    <div className=\"container space-y-5\">\r\n      <div className=\"card p-5\">\r\n        <div className=\"flex items-center justify-between flex-wrap gap-3\">\r\n          <div>\r\n            <h1 className=\"text-xl font-semibold\">Hallo {user.name || user.tagId}</h1>\r\n            <div className=\"mt-1\">Punkte: <span className=\"font-semibold\">{user.points}</span></div>\r\n          </div>\r\n        </div>\r\n        <form onSubmit={async(e)=>{\r\n          e.preventDefault();\r\n          if(!redeemPoints) return;\r\n          const r = await fetch('/api/redeem',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ points: redeemPoints })})\r\n          if (r.ok) {\r\n            setUser(u => u ? { ...u, points: Math.max(0, u.points - Number(redeemPoints)) } : u)\r\n            setRedeemPoints('')\r\n            setNotice({ type: 'success', text: 'Punkte eingelöst.' })\r\n          } else {\r\n            const d = await r.json().catch(()=>({ error: 'Fehler beim Einlösen' }))\r\n            setNotice({ type: 'error', text: d.error || 'Fehler beim Einlösen' })\r\n          }\r\n        }} className=\"mt-4 flex items-end gap-2\">\r\n          <div>\r\n            <label className=\"block text-sm\">Punkte einlösen</label>\r\n            <input type=\"number\" className=\"input w-32\" value={redeemPoints} onChange={e=>setRedeemPoints(parseInt(e.target.value||'0'))} />\r\n          </div>\r\n          <button className=\"btn btn-primary\">Einlösen</button>\r\n        </form>\r\n        {notice && (\r\n          <div className={`mt-3 text-sm px-3 py-2 rounded border ${notice.type==='success' ? 'border-green-600 text-green-400' : 'border-red-600 text-red-400'}`}>\r\n            <div className=\"flex items-center justify-between gap-3\">\r\n              <span>{notice.text}</span>\r\n              <button className=\"text-current\" onClick={()=>setNotice(null)}>✕</button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"card p-5\">\r\n        <h2 className=\"text-lg font-semibold\">Deine Aufgaben</h2>\r\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-3 mt-3\">\r\n          {assignments.filter(a=>a.status==='assigned' || a.status==='pending').map(a => (\r\n            <div key={a.id} className=\"border rounded p-3\">\r\n              <div className=\"font-medium flex items-center justify-between\">\r\n                <span>{a.taskTitle || `Task #${a.taskId}`}</span>\r\n                {a.tag && <span className=\"badge\">{a.tag}</span>}\r\n              </div>\r\n              {a.description && <div className=\"text-sm mt-1\">{a.description}</div>}\r\n              <div className=\"text-sm text-gray-600 mt-2\">{a.taskPoints ?? 0} Punkte</div>\r\n              <div className=\"mt-3\">\r\n                {a.status === 'assigned' ? (\r\n                  <button onClick={async()=>{await fetch(`/api/assignments/${a.id}`,{method:'PATCH', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ action:'complete' })}); location.reload()}} className=\"btn btn-primary w-full\">Abschließen</button>\r\n                ) : (\r\n                  <span className=\"text-sm text-gray-600\">Status: {a.status}</span>\r\n                )}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"card p-5\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <h2 className=\"text-lg font-semibold\">Store</h2>\r\n          <div className=\"text-sm text-gray-600\">Deine Punkte: <span className=\"font-semibold\">{user.points}</span></div>\r\n        </div>\r\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-3 mt-3\">\r\n          {items.map(it => (\r\n            <div key={it.id} className=\"border rounded p-3 space-y-2\">\r\n              <div className=\"font-medium flex items-center justify-between\">\r\n                <span className=\"break-words\">{it.title}</span>\r\n                <span className=\"badge\">{it.cost} Punkte</span>\r\n              </div>\r\n              {it.description && <div className=\"text-sm text-gray-600 break-words\">{it.description}</div>}\r\n              <button\r\n                disabled={user.points < it.cost}\r\n                onClick={async()=>{\r\n                  const r = await fetch('/api/store/redeem', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ itemId: it.id }) })\r\n                  if (r.ok) {\r\n                    const d = await r.json().catch(()=>null)\r\n                    const updatedPoints = d?.user?.points as number | undefined\r\n                    if (typeof updatedPoints === 'number') setUser(u => u ? { ...u, points: updatedPoints } : u)\r\n                    setNotice({ type: 'success', text: `\"${it.title}\" eingelöst.` })\r\n                  } else {\r\n                    const d = await r.json().catch(()=>({ error: 'Fehler' }))\r\n                    setNotice({ type: 'error', text: d.error || 'Fehler' })\r\n                  }\r\n                }}\r\n                className=\"btn btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                title={user.points < it.cost ? 'Zu wenig Punkte' : 'Einlösen'}\r\n              >\r\n                Einlösen\r\n              </button>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"card p-5\">\r\n        <h2 className=\"text-lg font-semibold\">Historie</h2>\r\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-3 mt-3\">\r\n          {assignments.filter(a=>a.status==='approved' || a.status==='rejected').map(a => (\r\n            <div key={a.id} className=\"border rounded p-3\">\r\n              <div className=\"font-medium flex items-center justify-between\">\r\n                <span>{a.taskTitle || `Task #${a.taskId}`}</span>\r\n                {a.tag && <span className=\"badge\">{a.tag}</span>}\r\n              </div>\r\n              {a.description && <div className=\"text-sm mt-1\">{a.description}</div>}\r\n              <div className=\"text-sm text-gray-600 mt-2\">{a.taskPoints ?? 0} Punkte</div>\r\n              <div className=\"mt-2 text-sm\">Status: {a.status}</div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}